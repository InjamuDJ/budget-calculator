<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Incentive Budget Calculator</title>
    <!-- Use Tailwind CSS for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for a clean look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Add a custom style for better checkbox appearance */
        .form-checkbox {
            appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #D1D5DB;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: inline-block;
            vertical-align: middle;
        }

        .form-checkbox:checked {
            background-color: #3B82F6;
            border-color: #3B82F6;
        }

        .form-checkbox:checked::before {
            content: 'âœ“';
            display: block;
            color: white;
            font-size: 0.875rem;
            line-height: 1;
            text-align: center;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <!-- The main container for the application -->
    <div id="app-container" class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl max-w-4xl w-full mx-auto border border-gray-200">
        <!-- Main header for the application -->
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">Performance Incentive Budget Calculator</h1>
        <p class="text-center text-gray-600 mb-8">Mark a category as a winner to see the budget amounts automatically redistribute.</p>

        <!-- Base Budget and Category Table -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700">Base Budget Split (KES <span id="total-budget">2,350</span>)</h2>
            <div class="overflow-x-auto rounded-xl border border-gray-300">
                <table class="w-full text-left table-auto">
                    <thead>
                        <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                            <th class="py-3 px-6 text-left">Category</th>
                            <th class="py-3 px-6 text-left">Eligible</th>
                            <th class="py-3 px-6 text-center">Base Allocation %</th>
                            <th class="py-3 px-6 text-right">Base Amount (KES)</th>
                            <th class="py-3 px-6 text-center">Winner?</th>
                            <th class="py-3 px-6 text-right">Redistributed Amount (KES)</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-600 text-sm font-light" id="budget-table-body">
                        <!-- Table rows will be populated here by JavaScript -->
                    </tbody>
                    <tfoot>
                        <tr class="bg-gray-100 font-bold text-gray-800">
                            <td class="py-3 px-6 text-left" colspan="5">Total</td>
                            <td class="py-3 px-6 text-right" id="total-amount">2,350</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <!-- The JavaScript logic to handle the calculations -->
    <script>
        // Data for the budget categories and the total budget
        const totalBudget = 2350;
        const categories = [
            { id: 'top-performer', name: 'Top Performer', eligible: 'Agents', allocation: 35 },
            { id: 'most-improved', name: 'Most Improved', eligible: 'Agents', allocation: 30 },
            { id: 'shoutout', name: 'Personal Shoutout from Client', eligible: 'Agents', allocation: 20 },
            { id: 'games-winner', name: 'Games Winner', eligible: 'Agents & TL', allocation: 15 }
        ];
        
        const tableBody = document.getElementById('budget-table-body');
        const totalAmountElement = document.getElementById('total-amount');
        const totalBudgetElement = document.getElementById('total-budget');
        let baseAmounts = [];

        /**
         * Rounds and adjusts amounts to ensure they sum to totalBudget
         */
        function adjustRounding(amounts, total) {
            const rounded = amounts.map(a => Math.round(a));
            const currentTotal = rounded.reduce((sum, val) => sum + val, 0);
            const diff = total - currentTotal;
            
            if (diff !== 0) {
                // Adjust the largest amount to compensate for rounding differences
                const maxIndex = amounts.reduce((iMax, x, i, arr) => 
                    x > arr[iMax] ? i : iMax, 0);
                rounded[maxIndex] += diff;
            }
            return rounded;
        }

        /**
         * Formats numbers with thousands separators
         */
        function formatNumber(num) {
            return num.toLocaleString('en-US', { 
                minimumFractionDigits: 0, 
                maximumFractionDigits: 0 
            });
        }

        /**
         * Renders the initial table rows and sets up event listeners
         */
        function initializeTable() {
            // Calculate base amounts with rounding adjustment
            const baseAmountsFloat = categories.map(c => totalBudget * (c.allocation / 100));
            baseAmounts = adjustRounding(baseAmountsFloat, totalBudget);
            
            const rowsHtml = categories.map((category, index) => {
                return `
                    <tr class="border-b border-gray-200 hover:bg-gray-100">
                        <td class="py-3 px-6 text-left whitespace-nowrap">${category.name}</td>
                        <td class="py-3 px-6 text-left">${category.eligible}</td>
                        <td class="py-3 px-6 text-center">${category.allocation}%</td>
                        <td class="py-3 px-6 text-right">${formatNumber(baseAmounts[index])}</td>
                        <td class="py-3 px-6 text-center">
                            <input type="checkbox" id="${category.id}" data-allocation="${category.allocation}" class="form-checkbox">
                        </td>
                        <td class="py-3 px-6 text-right text-base font-medium" id="amount-${category.id}">
                            ${formatNumber(baseAmounts[index])}
                        </td>
                    </tr>
                `;
            }).join('');
            
            tableBody.innerHTML = rowsHtml;
            
            // Set initial total amounts
            totalAmountElement.textContent = formatNumber(totalBudget);
            totalBudgetElement.textContent = formatNumber(totalBudget);

            // Add event listener to each checkbox
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', updateAmounts);
            });
        }

        /**
         * Recalculates and updates the budget amounts based on the selected winners
         */
        function updateAmounts() {
            const checkedBoxes = Array.from(
                document.querySelectorAll('input[type="checkbox"]:checked')
            );
            
            let totalCheckedAllocation = checkedBoxes.reduce((sum, checkbox) => 
                sum + parseFloat(checkbox.dataset.allocation), 0);

            // If no categories are selected, revert to base amounts
            if (checkedBoxes.length === 0) {
                categories.forEach((category, index) => {
                    const amountElement = document.getElementById(`amount-${category.id}`);
                    amountElement.textContent = formatNumber(baseAmounts[index]);
                });
                totalAmountElement.textContent = formatNumber(totalBudget);
                return;
            }

            // Calculate new amounts for winners
            const winnerAmounts = categories.map(category => {
                const checkbox = document.getElementById(category.id);
                return checkbox.checked ? 
                    (category.allocation / totalCheckedAllocation) * totalBudget : 
                    0;
            });

            // Adjust for rounding
            const adjustedAmounts = adjustRounding(winnerAmounts, totalBudget);

            // Update UI with new amounts
            categories.forEach((category, index) => {
                const amountElement = document.getElementById(`amount-${category.id}`);
                amountElement.textContent = formatNumber(adjustedAmounts[index]);
            });

            // Update the total (should always be totalBudget)
            totalAmountElement.textContent = formatNumber(totalBudget);
        }

        // Initialize the table on page load
        window.addEventListener('DOMContentLoaded', initializeTable);
    </script>
</body>
</html>
