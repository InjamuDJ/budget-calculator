<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Incentive Budget Calculator</title>
    <!-- Use Tailwind CSS for modern, responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for a clean look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Add a custom style for better checkbox appearance */
        .form-checkbox {
            appearance: none;
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid #D1D5DB;
            border-radius: 0.25rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            display: inline-block;
            vertical-align: middle;
        }

        .form-checkbox:checked {
            background-color: #3B82F6;
            border-color: #3B82F6;
        }

        .form-checkbox:checked::before {
            content: 'âœ“';
            display: block;
            color: white;
            font-size: 0.875rem;
            line-height: 1;
            text-align: center;
        }

        /* The table container will now use a flexbox layout for responsive stacking */
        @media (max-width: 640px) {
            .responsive-container {
                display: flex;
                flex-direction: column;
            }
            .responsive-table th, .responsive-table td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                border-bottom: 1px solid #E5E7EB;
                padding: 0.75rem 1.5rem;
            }
            .responsive-table thead {
                display: none;
            }
            .responsive-table tr {
                margin-bottom: 1rem;
                display: block;
                border: 1px solid #D1D5DB;
                border-radius: 0.5rem;
            }
            .responsive-table td:before {
                content: attr(data-label);
                font-weight: bold;
                text-transform: uppercase;
                margin-right: 1rem;
                min-width: 100px; /* Adjust as needed */
            }
            .responsive-table tfoot tr {
                display: flex;
                flex-direction: row;
            }
            .responsive-table tfoot td {
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <!-- The main container for the application -->
    <div id="app-container" class="bg-white p-6 sm:p-8 rounded-2xl shadow-xl max-w-4xl w-full mx-auto border border-gray-200">
        <!-- Main header for the application -->
        <h1 class="text-3xl sm:text-4xl font-bold text-center text-gray-800 mb-6">Performance Incentive Budget Calculator</h1>
        <p class="text-center text-gray-600 mb-8">Mark a category as a winner to see the budget amounts automatically redistribute.</p>

        <!-- Base Budget and Category Table -->
        <div class="mb-8">
            <h2 class="text-2xl font-semibold mb-4 text-gray-700">Base Budget Split (KES 2,350)</h2>
            <div class="overflow-hidden rounded-xl border border-gray-300">
                <table class="w-full text-left table-auto responsive-table">
                    <thead>
                        <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                            <th class="py-3 px-6 text-left">Category</th>
                            <th class="py-3 px-6 text-left">Eligible</th>
                            <th class="py-3 px-6 text-center">Base Allocation %</th>
                            <th class="py-3 px-6 text-right">Base Amount (KES)</th>
                            <th class="py-3 px-6 text-center">Winner?</th>
                            <th class="py-3 px-6 text-right">Redistributed Amount (KES)</th>
                        </tr>
                    </thead>
                    <tbody class="text-gray-600 text-sm font-light" id="budget-table-body">
                        <!-- Table rows will be populated here by JavaScript -->
                    </tbody>
                    <tfoot>
                        <tr class="bg-gray-100 font-bold text-gray-800">
                            <td class="py-3 px-6 text-left" colspan="5">Total</td>
                            <td class="py-3 px-6 text-right" id="total-amount">2,350</td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <!-- The JavaScript logic to handle the calculations -->
    <script>
        // Data for the budget categories and the total budget
        const totalBudget = 2350;
        const categories = [
            { id: 'top-performer', name: 'Top Performer', eligible: 'Agents', allocation: 40 },
            { id: 'most-improved', name: 'Most Improved', eligible: 'Agents', allocation: 27 },
            { id: 'shoutout', name: 'Personal Shoutout from Client', eligible: 'Agents', allocation: 18 },
            { id: 'games-winner', name: 'Games Winner', eligible: 'Agents & TL', allocation: 15 }
        ];
        
        const tableBody = document.getElementById('budget-table-body');
        const totalAmountElement = document.getElementById('total-amount');

        /**
         * Renders the initial table rows and sets up event listeners.
         */
        function initializeTable() {
            const rowsHtml = categories.map(category => {
                const baseAmount = totalBudget * (category.allocation / 100);
                return `
                    <tr class="border-b border-gray-200 hover:bg-gray-100">
                        <td class="py-3 px-6 text-left whitespace-nowrap" data-label="Category">${category.name}</td>
                        <td class="py-3 px-6 text-left" data-label="Eligible">${category.eligible}</td>
                        <td class="py-3 px-6 text-center" data-label="Allocation %">${category.allocation}%</td>
                        <td class="py-3 px-6 text-right" data-label="Base Amount">${baseAmount.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}</td>
                        <td class="py-3 px-6 text-center" data-label="Winner?">
                            <input type="checkbox" id="${category.id}" data-allocation="${category.allocation}" class="form-checkbox">
                        </td>
                        <td class="py-3 px-6 text-right text-base font-medium" data-label="Redistributed Amount" id="amount-${category.id}">
                            ${baseAmount.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}
                        </td>
                    </tr>
                `;
            }).join('');
            
            tableBody.innerHTML = rowsHtml;
            
            // Set initial total amount
            totalAmountElement.textContent = totalBudget.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });

            // Add event listener to each checkbox
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', updateAmounts);
            });
        }

        /**
         * Recalculates and updates the budget amounts based on the selected winners.
         */
        function updateAmounts() {
            const checkedBoxes = document.querySelectorAll('input[type="checkbox"]:checked');
            let totalCheckedAllocation = 0;

            // Calculate the total allocation of all winning categories
            checkedBoxes.forEach(checkbox => {
                totalCheckedAllocation += parseFloat(checkbox.dataset.allocation);
            });

            // If no categories are selected, revert to base amounts
            if (totalCheckedAllocation === 0) {
                categories.forEach(category => {
                    const amountElement = document.getElementById(`amount-${category.id}`);
                    const baseAmount = totalBudget * (category.allocation / 100);
                    amountElement.textContent = baseAmount.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
                });
                totalAmountElement.textContent = totalBudget.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
                return;
            }

            let newTotal = 0;
            // Calculate and update the new redistributed amount for each category
            categories.forEach(category => {
                const checkbox = document.getElementById(category.id);
                const amountElement = document.getElementById(`amount-${category.id}`);

                if (checkbox.checked) {
                    // Redistribution formula: (category_allocation / total_checked_allocation) * total_budget
                    const newAmount = (category.allocation / totalCheckedAllocation) * totalBudget;
                    amountElement.textContent = newAmount.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
                    newTotal += newAmount;
                } else {
                    // If the category is not a winner, its amount is 0
                    amountElement.textContent = "0";
                }
            });

            // Update the total at the bottom of the table
            totalAmountElement.textContent = newTotal.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 });
        }

        // Initialize the table on page load
        window.onload = initializeTable;

    </script>
</body>
</html>
